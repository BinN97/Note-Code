[COSMOS简介](#COSMOS简介)

[区块链](#区块链)

[COSMOS:更为广泛的区块链生态系统](#COSMOS-更为广泛的区块链生态系统)

[Tendermint BFT和ABCI](#Tendermint-BFT和ABCI)

[COSMOS SDK与其他应用层框架](#COSMOS-SDK与其他应用层框架)

[IBC 链接区块链](#IBC-链接区块链)

[总结](#总结)

# COSMOS简介
<b>COSMOS是一个独立并行区块链的去中心化网络，每个区块链都由Tendermint这样的BFT算法构建。</b>

即，COSMOS是一个区块链生态系统，可以互相协作、扩展。

特色：打破区块链的孤立、无法互相通信的局限，使得不同区块链可以连接在一起。

# 区块链
背景：
一组验证者（矿工）共同维护一份分布式数字账本，每个人自己保留一份独立的账本副本，在受到新的交易时按照事先预定的规则对自己的账本进行更新。目标是使得存在少数恶意验证者的情况下，账本仍然正确无误，被每个诚实节点正确复制。区块链是其首个应用。

对于区块链的定义，利用
+ 加密链式区块结构来验证与存储数据、
+ 利用分布式节点共识算法来生成和更新数据
+ 自动化脚本代码（智能合约）来编程和操作数据
新的去中心化的基础架构和分布式计算范式

理解为"Peer–to–Peer Encrypted Tampered–Resistence Database"，即”点对点的加密防篡改数据库“。

区块链是一个在全节点上复制的<b>确定性状态机</b>，只要恶意的维护者数量不超过1/3，就可以保持共识安全。

+ 状态机：保存一个状态，在收到输入时修改它。状态取决于应用程序和修改状态的交易。
+ 确定性：从genesis状态复制的交易，所有的结果状态相同。
+ 共识安全：每个复制状态机的诚实节点状态应该相同，不多于1/3的拜占庭节点，系统安全。

分为三层
+ Applications：更新交易状态
+ Consensus： 保证节点对系统状态达成一致
+ Networking：交易和共识相关消息传播

# COSMOS:更为广泛的区块链生态系统
+ 1.0 比特币
开发去中心化应用方案
  + 分叉比特币代码库
  + 建立在其之上
 问题：比特币的代码块耦合性严重，三层耦合在一起；此外，脚本语言有限，也不用户友好；
+ 2.0 以太坊
人们可以构建任意的去中心化区块链应用

使用<b>以太坊虚拟机</b>替换<b>应用层</b>来实现

局限性：
- 扩展性（Scalability）：交易速度（15笔/s）限制了应用程序
- 可用性（Usability）：EVM需要容纳所有的用户场景，对常用场景进行优化，导致开发人员对应用程序的效率和设计进行折中。同时受限于指定的编程语言，且代码无法自动执行
- 主权（Sovereignty)：由于基础环境相同，应用程序都会在主权方面受到限制。如果应用程序存在错误，无法进行任何操作，只能是经过以太坊平台本身进行治理（DAO）

+ 3.0 COSMOS
COSMOS的愿景是让开发者轻松构建区块链，并允许链之间可以进行交易（通信）来打破壁垒。
最终目的是<b> 创建一个以去中心化方式相互通信的区块链网络</b>

COSMOS可以保留区块链主权，快速处理交易并与生态系统中的其他区块链进行通信，服务于各种场景

COSMOS通过一系列工具来实现让人们构建自定义、安全、可扩展和可互操作的区块链应用
+ Tendermint：一个共识引擎和BFT算法。在此之上，可用任意语言实现一个状态机，负责信息的<b>一致安全</b>复制
+ COSMOS SDK：一个模块化框架，用来简化构建区块链应用
+ IBC：区块链之间的通信协议，允许区块链进行交互（数据和价值交换）

# Tendermint BFT和ABCI

以太坊借助虚拟机区块链，来简化DApp的开发流程，通过智能合约自行部署逻辑。但是区块链本身的开发并未简化，就像比特币一样，Ethereum仍然是耦合性较高的系统，这也是创建Tendermint的背景。

Tendermint BFT通过将区块链网络和共识机制打包成通用引擎的解决方案，确保开发者无需关注复杂的底层协议，集中于应用程序的开发，省下大量的时间。

Tendermint BFT引擎通过ABCI（Application Blockchain Interface)套接字（Socket）协议连接应用程序。封装协议无语言限制。

![](https://i.loli.net/2020/11/19/OlrVHNq5QJUGsEe.png)

特点：
+ 公私链无限制：Tendermint BFT只处理区块链网络和共识，负责传播交易和验证添加到区块链，验证机制可由开发者定制
+ 高性能：Tendermint BFT每秒可处理千笔交易
+ 即时最终确定性（Instant finality）：只要超过2/3的验证者是诚实的，就不会出错，用户可确保交易一旦创建即有效（比特币、以太坊多少区块后确认）
+ 安全：Tendermint共识具备容错性，同时还有问责机制

# COSMOS SDK与其他应用层框架
![Cosmos w'waSDK](https://i.loli.net/2020/11/20/qI5ePLdhOGUYbvX.png)
Tendermint BFT简化<b>区块链</b>开发，而借助COSMOS SDK可以构建一个ABCI应用来实现ABCI协议，即简化在Tendermint BFT上开发<b>区块链应用</b>。
+ 模块化：Cosmos SDK旨在创建一个生态系统，允许开发人员轻松的开发出特定区块链，无需为从头开始编写每个功能。任何人都可以在SDK中编写或引用现成的模块。例如，Tendermint团队为Cosmos Hub构建所需的模块。同时，开发在可以借助模块来定义其新的功能需求，随着Cosmos生态系统的扩大，SDK创建区块链应用程序将会变得更容易。
+ 基于功能的安全性：对模块之间的安全进行约束。

总结：Cosmos SDK允许开发者在Tendermint BFT上进行构建应用，将来也可以应用于其它实现ABCI协议的共识引擎之上，共同拓展Cosmos的生态系统。

## Ethermint
Cosmos SDK模块化的功能支持开发者将现有的区块链移植到其上，Ethermint就是一个例子，原理与标准以太坊（Go）完全一致，具有Tendermint BFT的共识属性，以太坊的所有工具（Truffle、Metamask等）均可在Ethermint使用，智能合约也能快速移植过来。

Ethermint将以太坊虚拟机转换为Cosmos-SDK模块，通过与其他Cosmos模块（staking）结合，能够运行以太坊智能合约的全部功能的POS区块链。

问题:既然能在已有的区块链上部署去中心化应用，为什么还要用Cosmos DDK来创建区块链？

主要还是上面讲到的，一是开发区块链更为困难，其次还有灵活性、安全性、性能和主权方面的优势。
# IBC:链接区块链
区块链间通信协议（Inter-Blockchain Conmunication Procotol，IBC）借助Tendermint共识的“即时最终性”，实现区块链之间的连接，进行数据传播和价值转换。

## 异构链
+ 同构链:安全机制、共识算法、网络拓扑、区块生成验证逻辑、应用部分一致，区块链之间的跨链交互相对简单。

+ 异构链:由于上述机制存在不同，跨链交互相对复杂，例如，比特币采用POS共识算法，而fabric采用传统确定性共识算法，从区块的组成原理到确定性保护机制都有差异，难以直接设计交互方案，一般就需要借助辅助服务进行跨链操作，IBC就是这样一种辅助服务，

## IBC工作原理
以链A向链B发送10个代币为例
+ 跟踪:链B不间断接收A的报头，跟踪其验证节点集合，可以理解为每个链都运行一个其他链的轻客户端。
+ 锁定:启动IBC转移时，代币被锁定在链A上
+ 中继证明（prooc delay）:链A发送一个10代币被锁定的证明给B
+ 验证:链B对链A的区块头进行验证，验证有效会在B上创建10个代币凭证（vouchers），注意这是代币被冻结在A上的证明，不属于真的代币
+ 回到A。采用类似的机制解锁代币

## IBC链接方案
一种是区块链间两两互联，但这随着网络中的区块链数量增长呈现二次增长，链接代价较大；

另一种就是类似Cosmos提出的模块化结构，主要包含:Hubs和Zones，前者是为链接Zones单独设计的区块链，可以访问所有链接到它的Zone，后者就是需要链接的异构链。这样建立的链接代价就会大大降低。Hubs可以有效防范双花问题。
![](https://i.loli.net/2020/11/22/hknaegVWvOc2JMp.png)

Cosmos的第一个Hub称为Cosmos Hub，属于权益证明（POS)链，原生代币为ATOM，支持与不同token转换。

# 总结
+ Cosmos提供Tendermint BFT和模块化Cosmos SDK简化区块链开发
+ Cosmos提供IBC，支持区块链间数据传播与价值转移，保留链的主权
+ 为用户提供丰富的扩展性解决方案



